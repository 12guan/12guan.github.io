<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Appium案例整合 | 书</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  
  
    <link rel="alternate" href="/atom.xml" title="书" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/localshare/css/share.css">

  
  
    
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">书</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/."><i class="fa fa-home"></i> 首页</a>
        
          <a class="main-nav-link" href="/archives/"><i class="fa fa-archive"></i> 归档</a>
        
          <a class="main-nav-link" href="/about/"><i class="fa fa-user"></i> 关于</a>
        
          <a class="main-nav-link" href="/atom.xml"><i class="fa fa-rss"></i> 订阅</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Appium案例整合" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Appium案例整合
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-09-09T09:23:37.000Z" itemprop="datePublished">2021年09月09日</time>
</span>
      
      
        <span class="article-views">
  <i class="fa fa-views"></i>
  <i id="busuanzi_container_page_pv">
      <i id="busuanzi_value_page_pv"></i>
  </i>
</span>

      
      
<a href="/2021/09/09/Appium%E6%A1%88%E4%BE%8B%E6%95%B4%E5%90%88/#comments" class="article-comment-link">
  
    
    
    
    
    
  
  <i class="fa fa-commt"></i>
  留言
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="一、Pageobject-unittest"><a href="#一、Pageobject-unittest" class="headerlink" title="一、Pageobject+unittest"></a>一、<strong>Pageobject+unittest</strong></h1><p>在前面我们都是基于线性模型来编写测试脚本，而且元素定位方式和属性值都是写死的。在业务场景简单的情况下这样写无可厚非，但是一旦遇到产品需求变更，业务逻辑比较复杂需要维护的时候就非常麻烦了，那么该如何应对这种情况呢？<span id="more"></span></p>
<h2 id="1-场景案例"><a href="#1-场景案例" class="headerlink" title="1. 场景案例"></a><strong>1. 场景案例</strong></h2><p>前面我们所学，测试考研帮App登录场景，按照线性模型来构造出脚本如下： </p>
<p>考研帮登录测试场景脚本：</p>
<pre class="line-numbers language-none"><code class="language-none">from appium import webdriver
import yaml
from selenium.common.exceptions import NoSuchElementException
import logging
import logging.config


CON_LOG&#x3D;&#39;.&#x2F;log&#x2F;log.conf&#39;
logging.config.fileConfig(CON_LOG)
logging&#x3D;logging.getLogger()


stream&#x3D;open(&#39;.&#x2F;yaml&#x2F;desired_caps.yaml&#39;,&#39;r&#39;)
data&#x3D;yaml.load(stream)

desired_caps&#x3D;&#123;&#125;
desired_caps[&#39;platformName&#39;]&#x3D;data[&#39;platformName&#39;]

desired_caps[&#39;platformVersion&#39;]&#x3D;data[&#39;platformVersion&#39;]
desired_caps[&#39;deviceName&#39;]&#x3D;data[&#39;deviceName&#39;]

desired_caps[&#39;app&#39;]&#x3D;data[&#39;app&#39;]
desired_caps[&#39;noReset&#39;]&#x3D;data[&#39;noReset&#39;]



desired_caps[&#39;appPackage&#39;]&#x3D;data[&#39;appPackage&#39;]
desired_caps[&#39;appActivity&#39;]&#x3D;data[&#39;appActivity&#39;]

driver &#x3D; webdriver.Remote(&#39;http:&#x2F;&#x2F;&#39;+str(data[&#39;ip&#39;])+&#39;:&#39;+str(data[&#39;port&#39;])+&#39;&#x2F;wd&#x2F;hub&#39;, desired_caps)

def check_updateBtn():
    logging.info(&quot;check_updateBtn&quot;)
    try:
        element &#x3D; driver.find_element_by_id(&#39;android:id&#x2F;button2&#39;)
    except NoSuchElementException:
        logging.info(&#39;update element is not found!&#39;)
    else:
        element.click()


def check_skipBtn():
    logging.info(&quot;check_skipBtn&quot;)
    try:
        element &#x3D; driver.find_element_by_id(&#39;com.tal.kaoyan:id&#x2F;tv_skip&#39;)
    except NoSuchElementException:
        logging.info(&#39;skipBtn element is not found!&#39;)
    else:
        element.click()

check_updateBtn()
check_skipBtn()

logging.info(&#39;start login...&#39;)

driver.find_element_by_id(&#39;com.tal.kaoyan:id&#x2F;login_email_edittext&#39;).send_keys(&#39;liubo10010&#39;)
driver.find_element_by_id(&#39;com.tal.kaoyan:id&#x2F;login_password_edittext&#39;).send_keys(&#39;liubo10010&#39;)
driver.find_element_by_id(&#39;com.tal.kaoyan:id&#x2F;login_login_btn&#39;).click()
logging.info(&#39;login finished&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="1-案例分析"><a href="#1-案例分析" class="headerlink" title="1) 案例分析"></a>1) <strong>案例分析</strong></h3><p>上面的脚本看似都比较完善，有了log采集，参数配置、启动时页面元素自动检测。但是也存在一些不足之处：</p>
<ul>
<li>公共模块和业务模块混合在一起显得代码冗余等</li>
<li>测试场景单一（如果要实现如下测试场景该怎么办？）</li>
<li>元素定位属性和代码混杂在一起</li>
</ul>
<p>以上这些都是需要优化的地方。</p>
<table>
<thead>
<tr>
<th><strong>测试场景</strong></th>
<th><strong>操作步骤</strong></th>
<th><strong>预期结果</strong></th>
</tr>
</thead>
<tbody><tr>
<td>多账号登录</td>
<td>不同的用户名密码来进行登录</td>
<td>能够正常登录</td>
</tr>
<tr>
<td>异常登录</td>
<td>用户名或者密码错误、或者为空进行登录，</td>
<td>登录失败，同时界面要给出相应的提示</td>
</tr>
<tr>
<td>注册</td>
<td>点击注册，然后进行注册信息填写</td>
<td>能够注册成功</td>
</tr>
</tbody></table>
<h3 id="2-重构优化思路"><a href="#2-重构优化思路" class="headerlink" title="2) 重构优化思路"></a><strong>2) 重构优化思路</strong></h3><ul>
<li>将一些公共的内容（如：check_updateBtn，check_skipBtn,capability）抽离出来。</li>
<li>元素定位方法和元素属性值与业务代码分离</li>
<li>登录功能模块封装为一个独立的模块</li>
<li>使用unittest进行用例综合管理</li>
</ul>
<h3 id="3-Page-Object"><a href="#3-Page-Object" class="headerlink" title="3) Page Object"></a><strong>3) Page Object</strong></h3><p><strong>Page Object是Selenium自动化测试项目开发实践的最佳设计模式之一，通过对界面元素的封装减少冗余代码，同时在后期维护中，若元素定位发生变化，只需要调整页面元素封装的代码，提高测试用例的可维护性。</strong></p>
<h2 id="2-代码实现"><a href="#2-代码实现" class="headerlink" title="2. 代码实现"></a><strong>2. 代码实现</strong></h2><p><strong>封装App启动配置信息</strong> </p>
<p><strong>desired_caps.py</strong></p>
<pre class="line-numbers language-none"><code class="language-none">import yaml
import logging.config
from appium import webdriver

#把app启动封装到一个类里面

CON_LOG &#x3D; &#39;..&#x2F;log&#x2F;log.conf&#39;
logging.config.fileConfig(CON_LOG)
logging &#x3D; logging.getLogger()


def appium_desired():

    stream &#x3D; open(&#39;..&#x2F;yaml&#x2F;desired_caps.yaml&#39;, &#39;r&#39;)
    data &#x3D; yaml.load(stream)

    desired_caps&#x3D;&#123;&#125;
    desired_caps[&#39;platformName&#39;]&#x3D;data[&#39;platformName&#39;]

    desired_caps[&#39;platformVersion&#39;]&#x3D;data[&#39;platformVersion&#39;]
    desired_caps[&#39;deviceName&#39;]&#x3D;data[&#39;deviceName&#39;]

    desired_caps[&#39;app&#39;]&#x3D;data[&#39;app&#39;]
    desired_caps[&#39;noReset&#39;]&#x3D;data[&#39;noReset&#39;]

    desired_caps[&#39;unicodeKeyboard&#39;]&#x3D;data[&#39;unicodeKeyboard&#39;]
    desired_caps[&#39;resetKeyboard&#39;]&#x3D;data[&#39;resetKeyboard&#39;]

    desired_caps[&#39;appPackage&#39;]&#x3D;data[&#39;appPackage&#39;]
    desired_caps[&#39;appActivity&#39;]&#x3D;data[&#39;appActivity&#39;]

    logging.info(&#39;start run app...&#39;)
    driver &#x3D; webdriver.Remote(&#39;http:&#x2F;&#x2F;&#39;+str(data[&#39;ip&#39;])+&#39;:&#39;+str(data[&#39;port&#39;])+&#39;&#x2F;wd&#x2F;hub&#39;, desired_caps)

    driver.implicitly_wait(8)
    return driver

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    appium_desired()
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>记得在原来的yaml配置表desired_caps.yaml补充如下内容：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">unicodeKeyboard: True 
resetKeyboard: True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>封装基类</strong>:</p>
<p><strong>BaseView.py</strong></p>
<ol>
<li>初始化——获取driver</li>
<li>写一个获取所有元素的函数</li>
</ol>
<p><strong>#封装对应基类</strong></p>
<pre class="line-numbers language-none"><code class="language-none">#封装对应基类
class BaseView(object):
    def __init__(self,driver):
        self.driver&#x3D;driver

    def find_element(self,*loc):
        return self.driver.find_element(*loc)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>封装通用公共类 common_fun.py</strong></p>
<pre class="line-numbers language-none"><code class="language-none">from Base_View import *
from desired_caps import *
from selenium.common.exceptions import NoSuchElementException
import logging
from selenium.webdriver.common.by import By

class Common(BaseView):
    cancelBtn&#x3D;(By.ID,&#39;android:id&#x2F;button2&#39;)
    skipBtn&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;tv_skip&#39;)

    def check_cancelBtn(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;check_cancelBtn&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        try:
            cancelBtn &#x3D; self.driver.find_element(*self.cancelBtn)
        except NoSuchElementException:
            logging.info(&#39;no cancelBtn&#39;)
        else:
            cancelBtn.click()

    def check_skipBtn(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;check skipBtn&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)

        try:
            skipBtn &#x3D; self.driver.find_element(*self.skipBtn)
        except NoSuchElementException:
            logging.info(&#39;no skipBtn&#39;)
        else:
            skipBtn.click()

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    driver&#x3D;appium_desired()
    com&#x3D;Common(driver)
    com.check_cancelBtn()
    com.check_skipBtn()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>封装登录操作</strong></p>
<p><strong>loginView.py</strong></p>
<pre class="line-numbers language-none"><code class="language-none">import logging
from common_fun import *
from  desired_caps import *
from selenium.webdriver.common.by import By

class LoginView(Common):

    username_type&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;login_email_edittext&#39;)
    password_type&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;login_password_edittext&#39;)
    loginBtn&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;login_login_btn&#39;)


    def login_action(self,username,password):
        self.check_cancelBtn()
        self.check_skipBtn()

        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;login&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        logging.info(&#39;input username:%s&#39;%username)
        self.driver.find_element(*self.username_type).send_keys(username)

        logging.info(&#39;input password:%s&#39;%password)
        self.driver.find_element(*self.password_type).send_keys(password)

        logging.info(&#39;click loginBtn.&#39;)
        self.driver.find_element(*self.loginBtn).click()
        logging.info(&#39;login finished &#39;)

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    driver&#x3D;appium_desired()
    l&#x3D;LoginView(driver)
    l.login_action(&#39;xx&#39;,&#39;aa&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="3-unittest用例封装"><a href="#3-unittest用例封装" class="headerlink" title="3. unittest用例封装"></a>3. unittest用例封装</h2><p><strong>测试场景：使用如下账号进行分别登录测试</strong></p>
<table>
<thead>
<tr>
<th><strong>用户名</strong></th>
<th><strong>密码</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>xxxx</strong></td>
<td><strong>aaaa</strong></td>
</tr>
<tr>
<td><strong>666</strong></td>
<td><strong>222</strong></td>
</tr>
</tbody></table>
<p><strong>1.封装用例启动、结束时的配置：</strong></p>
<p><strong>myunit.py</strong></p>
<pre class="line-numbers language-none"><code class="language-none">import unittest
from appium_Test4.page_object.desired_caps import appium_desired
import logging
from time import sleep

#unitTest创建与销毁
class StartEnd(unittest.TestCase):
    def setUp(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;setUp&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        self.driver&#x3D;appium_desired()

    def tearDown(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;tearDown&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        sleep(5)
        self.driver.close_app()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2. 用例封装</strong></p>
<p><strong>test_login.py</strong></p>
<pre class="line-numbers language-none"><code class="language-none">from  appium_Test4.unitTest.myunit import StartEnd
from appium_Test4.page_object.loginView import LoginView
import unittest
import logging

class TestLogin(StartEnd):


    def test_login_xx(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;test_login_xx&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        l&#x3D;LoginView(self.driver)
        l.login_action(&#39;xxxx&#39;,&#39;aaaa&#39;)



    def test_login_error(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;test_login_error&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        l&#x3D;LoginView(self.driver)
        l.login_action(&#39;666&#39;,&#39;222&#39;)

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    unittest.main()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>项目代码结构：</p>
<p><img src="https://pic.imgdb.cn/item/6139d59344eaada739043265.jpg"></p>
<h1 id="二、自动化测试框架综合案例"><a href="#二、自动化测试框架综合案例" class="headerlink" title="二、自动化测试框架综合案例"></a><strong>二、自动化测试框架综合案例</strong></h1><h2 id="1-框架功能"><a href="#1-框架功能" class="headerlink" title="1. 框架功能"></a><strong>1. 框架功能</strong></h2><p><strong>1) 业务功能的封装</strong></p>
<p><strong>2) 测试用例封装</strong></p>
<p><strong>3) 测试包管理</strong></p>
<p><strong>4) 截图处理</strong></p>
<p><strong>5) 断言处理</strong></p>
<p><strong>6) 日志获取</strong></p>
<p><strong>7) 测试报告生成</strong></p>
<p><strong>8) 配置参数</strong></p>
<h2 id="2-测试案例"><a href="#2-测试案例" class="headerlink" title="2. 测试案例"></a><strong>2. 测试案例</strong></h2><h4 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a><strong>测试环境</strong></h4><ul>
<li>ppium-desktop 1.5.0</li>
<li>考研帮App Android版3.1.0</li>
<li>夜神模拟器 Android 7.1.2</li>
<li>Win 10 64位</li>
</ul>
<h4 id="覆盖用例"><a href="#覆盖用例" class="headerlink" title="覆盖用例"></a><strong>覆盖用例</strong></h4><p><strong>1.登录场景</strong></p>
<table>
<thead>
<tr>
<th><strong>用户名</strong></th>
<th><strong>密码</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>cccc</strong></td>
<td><strong>cccc</strong></td>
</tr>
<tr>
<td><strong>666</strong></td>
<td><strong>222</strong></td>
</tr>
</tbody></table>
<h2 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a><strong>3. 代码实现</strong></h2><h3 id="1-driver配置封装"><a href="#1-driver配置封装" class="headerlink" title="1) driver配置封装"></a><strong>1) driver配置封装</strong></h3><p><strong>kyb_caps.yaml</strong> 配置表</p>
<pre class="line-numbers language-none"><code class="language-none">platformName: Android
platformVersion: 7.1.2
deviceName: 127.0.0.1:62025
appname: kaoyan3.1.0.apk
noReset: False
unicodeKeyboard: True
resetKeyboard: True
appPackage: com.tal.kaoyan
appActivity: com.tal.kaoyan.ui.activity.SplashActivity
ip: 127.0.0.1
port: 4723<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>desired_caps.py</strong></p>
<pre class="line-numbers language-none"><code class="language-none">from appium import webdriver
import yaml
import logging
import logging.config
import os

CON_LOG&#x3D;&#39;..&#x2F;config&#x2F;log.conf&#39;
logging.config.fileConfig(CON_LOG)
logging&#x3D;logging.getLogger()

def appium_desired():
    with open(&#39;..&#x2F;config&#x2F;kyb_caps.yaml&#39;,&#39;r&#39;,encoding&#x3D;&#39;utf-8&#39;) as file:
        data&#x3D;yaml.load(file)

    desired_caps&#x3D;&#123;&#125;
    desired_caps[&#39;platformName&#39;]&#x3D;data[&#39;platformName&#39;]
    desired_caps[&#39;platformVersion&#39;]&#x3D;data[&#39;platformVersion&#39;]
    desired_caps[&#39;deviceName&#39;]&#x3D;data[&#39;deviceName&#39;]

    base_dir &#x3D; os.path.dirname(os.path.dirname(__file__))
    app_path &#x3D; os.path.join(base_dir, &#39;app&#39;, data[&#39;appname&#39;])
    desired_caps[&#39;app&#39;]&#x3D;app_path

    desired_caps[&#39;appPackage&#39;]&#x3D;data[&#39;appPackage&#39;]
    desired_caps[&#39;appActivity&#39;]&#x3D;data[&#39;appActivity&#39;]
    desired_caps[&#39;noReset&#39;]&#x3D;data[&#39;noReset&#39;]


    desired_caps[&#39;unicodeKeyboard&#39;]&#x3D;data[&#39;unicodeKeyboard&#39;]
    desired_caps[&#39;resetKeyboard&#39;]&#x3D;data[&#39;resetKeyboard&#39;]

    logging.info(&#39;start app...&#39;)
    driver&#x3D;webdriver.Remote(&#39;http:&#x2F;&#x2F;&#39;+str(data[&#39;ip&#39;])+&#39;:&#39;+str(data[&#39;port&#39;])+&#39;&#x2F;wd&#x2F;hub&#39;,desired_caps)
    driver.implicitly_wait(8)
    return driver

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    appium_desired()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>相对路径符号含义</strong></p>
<p><strong>1. “.”表示当前目录</strong></p>
<p><strong>2. “..” 表示当前目录的上一级目录。</strong></p>
<p><strong>3. “./”表示当前目录下的某个文件或文件夹，视后面跟着的名字而定</strong></p>
<p><strong>4. “../”表示当前目录上一级目录的文件或文件夹，视后面跟着的名字而定。</strong></p>
<h3 id="2-基类封装"><a href="#2-基类封装" class="headerlink" title="2) 基类封装"></a><strong>2) 基类封装</strong></h3><p><strong>baseView.py</strong></p>
<pre class="line-numbers language-none"><code class="language-none">class BaseView(object):
    def __init__(self,driver):
        self.driver&#x3D;driver

    def find_element(self,*loc):
        return self.driver.find_element(*loc)

    def find_elements(self,*loc):
        return self.driver.find_elements(*loc)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="3-common公共模块封装"><a href="#3-common公共模块封装" class="headerlink" title="3) common公共模块封装"></a><strong>3) common公共模块封装</strong></h3><p><strong>公共方法封装 :</strong></p>
<p><strong>common_fun.py</strong></p>
<pre class="line-numbers language-none"><code class="language-none">from baseView.baseView import BaseView
from common.desired_caps import appium_desired
from selenium.common.exceptions import NoSuchElementException
import logging
from selenium.webdriver.common.by import By
import time,os
import csv

class Common(BaseView):
    cancelBtn&#x3D;(By.ID,&#39;android:id&#x2F;button2&#39;)
    skipBtn&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;tv_skip&#39;)
    wemedia_cacel&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;view_wemedia_cacel&#39;)


    def check_cancelBtn(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;check_cancelBtn&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        try:
            cancelBtn &#x3D; self.driver.find_element(*self.cancelBtn)
        except NoSuchElementException:
            logging.info(&#39;no cancelBtn&#39;)
        else:
            cancelBtn.click()

    def check_skipBtn(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;check skipBtn&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)

        try:
            skipBtn &#x3D; self.driver.find_element(*self.skipBtn)
        except NoSuchElementException:
            logging.info(&#39;no skipBtn&#39;)
        else:
            skipBtn.click()
   
    def getTime(self):
        self.now&#x3D;time.strftime(&quot;%Y-%m-%d %H_%M_%S&quot;)
        return self.now

    def getScreenShot(self,module):
        time&#x3D;self.getTime()
        image_file&#x3D;os.path.dirname(os.path.dirname(__file__))+&#39;&#x2F;screenshots&#x2F;%s_%s.png&#39; %(module,time)

        logging.info(&#39;get %s screenshot&#39; %module)
        self.driver.get_screenshot_as_file(image_file)

    def check_market_ad(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;check_market_ad&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        try:
            element&#x3D;self.driver.find_element(*self.wemedia_cacel)
        except NoSuchElementException:
            pass
        else:
            logging.info(&#39;close market ad&#39;)
            element.click()

    def get_csv_data(self,csv_file,line):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;get_csv_data&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        with open(csv_file,&#39;r&#39;,encoding&#x3D;&#39;utf-8-sig&#39;) as file:
            reader&#x3D;csv.reader(file)
            for index,row in enumerate(reader,1):
                if index&#x3D;&#x3D;line:
                    return row

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    driver &#x3D; appium_desired()
    c&#x3D;Common(driver)
    c.check_cancelBtn()
    # # c.check_skipBtn()
    # c.swipeLef()
    # c.swipeLef()
    # c.getScreenShot(&quot;startApp&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="4-业务模块封装"><a href="#4-业务模块封装" class="headerlink" title="4) 业务模块封装"></a><strong>4) 业务模块封装</strong></h3><h4 id="1-登录页面业务逻辑模块"><a href="#1-登录页面业务逻辑模块" class="headerlink" title="1. 登录页面业务逻辑模块"></a><strong>1. 登录页面业务逻辑模块</strong></h4><p><strong>loginView.py</strong></p>
<pre class="line-numbers language-none"><code class="language-none">import logging
from common.common_fun import Common,NoSuchElementException
from common.desired_caps import appium_desired
from selenium.webdriver.common.by import By

class LoginView(Common):
    username_type&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;login_email_edittext&#39;)
    password_type&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;login_password_edittext&#39;)
    loginBtn&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;login_login_btn&#39;)

    tip_commit&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;tip_commit&#39;)

    button_mysefl&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;mainactivity_button_mysefl&#39;)
    username&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;activity_usercenter_username&#39;)

    RightButton&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;myapptitle_RightButton_textview&#39;)
    logoutBtn&#x3D;(By.ID,&#39;com.tal.kaoyan:id&#x2F;setting_logout_text&#39;)

   def login_action(self,username,password):
        self.check_cancelBtn()
        self.check_skipBtn()

        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;login_action&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        logging.info(&#39;username is:%s&#39; %username)
        self.driver.find_element(*self.username_type).send_keys(username)

        logging.info(&#39;password is:%s&#39;%password)
        self.driver.find_element(*self.password_type).send_keys(password)

        logging.info(&#39;click loginBtn&#39;)
        self.driver.find_element(*self.loginBtn).click()
        logging.info(&#39;login finished!&#39;)

    def check_account_alert(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;check_account_alert&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        try:
            element&#x3D;self.driver.find_element(*self.tip_commit)
        except NoSuchElementException:
            pass
        else:
            logging.info(&#39;close tip_commit&#39;)
            element.click()

    def check_loginStatus(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;check_loginStatus&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        self.check_market_ad()
        self.check_account_alert()

        try:

            self.driver.find_element(*self.button_mysefl).click()
            self.driver.find_element(*self.username)
        except NoSuchElementException:
            logging.error(&#39;login Fail!&#39;)
            self.getScreenShot(&#39;login fail&#39;)
            return False
        else:
            logging.info(&#39;login success!&#39;)
            self.logout_action()
            return True

    def logout_action(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;logout_action&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        self.driver.find_element(*self.RightButton).click()
        self.driver.find_element(*self.logoutBtn).click()
        self.driver.find_element(*self.tip_commit).click()

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    driver&#x3D;appium_desired()
    l&#x3D;LoginView(driver)
    l.login_action(&#39;cccc&#39;,&#39;cccc&#39;)

    l.check_loginStatus()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="2-data数据封装"><a href="#2-data数据封装" class="headerlink" title="2. data数据封装"></a><strong>2. data数据封装</strong></h4><h5 id="使用背景"><a href="#使用背景" class="headerlink" title="使用背景"></a>使用背景</h5><p><strong>在实际项目过程中，我们的数据可能是存储在一个数据文件中，如txt,excel、csv文件类型。我们可以封装一些方法来读取文件中的数据来实现数据驱动。</strong></p>
<h5 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h5><p><strong>将测试账号存储在account.csv文件，内容如下：</strong></p>
<table>
<thead>
<tr>
<th><strong>用户名</strong></th>
<th><strong>密码</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Dddd1</strong></td>
<td><strong>Dddd1</strong></td>
</tr>
<tr>
<td><strong>666</strong></td>
<td><strong>222</strong></td>
</tr>
</tbody></table>
<h5 id="enumerate-简介"><a href="#enumerate-简介" class="headerlink" title="enumerate()简介"></a><strong>enumerate()简介</strong></h5><p><strong>enumerate()是python的内置函数</strong></p>
<ul>
<li>enumerate在字典上是枚举、列举的意思</li>
<li> 对于一个可迭代的（iterable）/可遍历的对象（如列表、字符串），enumerate将其组成一个索引序列，利用它可以同时获得索引和值</li>
<li>enumerate多用于在for循环中得到计数。</li>
</ul>
<h5 id="enumerate-使用"><a href="#enumerate-使用" class="headerlink" title="enumerate()使用"></a>enumerate()使用</h5><p><strong>如果对一个列表，既要遍历索引又要遍历元素时，首先可以这样写：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">list &#x3D; [&quot;这&quot;, &quot;是&quot;, &quot;一个&quot;, &quot;测试&quot;,&quot;数据&quot;]
    for i in range(len(list)):
        print(i,list[i])
&gt;&gt;&gt;
0 这
1 是
2 一个
3 测试
4 数据<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>上述方法有些累赘，利用enumerate()会更加直接和优美：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">list1 &#x3D; [&quot;这&quot;, &quot;是&quot;, &quot;一个&quot;, &quot;测试&quot;,&quot;数据&quot;]
    for index, item in enumerate(list1):
        print(index,item)
&gt;&gt;&gt;
0 这
1 是
2 一个
3 测试
4 数据<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="数据读取方法封装"><a href="#数据读取方法封装" class="headerlink" title="数据读取方法封装"></a><strong>数据读取方法封装</strong></h5><p><strong>import csv</strong></p>
<pre class="line-numbers language-none"><code class="language-none">import csv

     def get_csv_data(csv_file,line):
        with open(csv_file, &#39;r&#39;, encoding&#x3D;&#39;utf-8-sig&#39;) as file:
            reader&#x3D;csv.reader(file)
            for index, row in enumerate(reader,1):
                if index &#x3D;&#x3D; line:
                    return row

    csv_file&#x3D;&#39;..&#x2F;data&#x2F;account.csv&#39;
    data&#x3D;get_csv_data(csv_file,3)
    print(data)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="utf-8与utf-8-sig两种编码格式的区别"><a href="#utf-8与utf-8-sig两种编码格式的区别" class="headerlink" title="utf-8与utf-8-sig两种编码格式的区别:"></a>utf-8与utf-8-sig两种编码格式的区别:</h5><p>UTF-8以字节为编码单元，它的字节顺序在所有系统中都是一样的，没有字节序的问题，也因此它实际上并不需要BOM(“ByteOrder Mark”)。</p>
<p>但是UTF-8 with BOM即utf-8-sig需要提供BOM。</p>
<h4 id="3-config文件配置"><a href="#3-config文件配置" class="headerlink" title="3. config文件配置"></a><strong>3. config文件配置</strong></h4><p>日志文件配置 </p>
<p><strong>log.config</strong></p>
<pre class="line-numbers language-none"><code class="language-none">[loggers]
keys&#x3D;root,infoLogger

[logger_root]
level&#x3D;DEBUG
handlers&#x3D;consoleHandler,fileHandler

[logger_infoLogger]
handlers&#x3D;consoleHandler,fileHandler
qualname&#x3D;infoLogger
propagate&#x3D;0

[handlers]
keys&#x3D;consoleHandler,fileHandler

[handler_consoleHandler]
class&#x3D;StreamHandler
level&#x3D;INFO
formatter&#x3D;form02
args&#x3D;(sys.stderr,)

[handler_fileHandler]
class&#x3D;FileHandler
level&#x3D;INFO
formatter&#x3D;form01
args&#x3D;(&#39;..&#x2F;logs&#x2F;runlog.log&#39;, &#39;a&#39;)

[formatters]
keys&#x3D;form01,form02

[formatter_form01]
format&#x3D;%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s

[formatter_form02]
format&#x3D;%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="4-测试用例封装"><a href="#4-测试用例封装" class="headerlink" title="4. 测试用例封装"></a><strong>4. 测试用例封装</strong></h4><ol>
<li><p>测试用例执行开始结束操作封装 </p>
<p><strong>myunit.py</strong></p>
</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">import unittest
from common.desired_caps import appium_desired
import logging
from time import sleep

class StartEnd(unittest.TestCase):
    def setUp(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;setUp&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        self.driver&#x3D;appium_desired()

    def tearDown(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;tearDown&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        sleep(5)
        self.driver.close_app()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<ol start="2">
<li><p>登录用例：</p>
<p><strong>test_login.py</strong></p>
</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">from common.myunit import StartEnd
from businessView.loginView import LoginView
import unittest
import logging

class TestLogin(StartEnd):
    csv_file&#x3D;&#39;..&#x2F;data&#x2F;account.csv&#39;


    def test_login_dd(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;test_login_dd&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        l&#x3D;LoginView(self.driver)
        data&#x3D;l.get_csv_data(self.csv_file,2)
        l.login_action(data[0],data[1])
        self.assertTrue(l.check_loginStatus())


    @unittest.skip(&#39;test_login_error&#39;)
    def test_login_error(self):
        logging.info(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;test_login_error&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;)
        l &#x3D; LoginView(self.driver)
        data &#x3D; l.get_csv_data(self.csv_file, 3)

        l.login_action(data[0], data[1])
        self.assertTrue(l.check_loginStatus(),msg&#x3D;&#39;login fail!&#39;)

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    unittest.main()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="5-执行测试用例-amp-报告生成"><a href="#5-执行测试用例-amp-报告生成" class="headerlink" title="5. 执行测试用例&amp;报告生成"></a><strong>5. 执行测试用例&amp;报告生成</strong></h4><p><strong>run.py</strong></p>
<pre class="line-numbers language-none"><code class="language-none">import unittest
from  BSTestRunner import BSTestRunner
import time,logging
import sys
path&#x3D;&#39;D:\\kyb_testProject\\&#39;
sys.path.append(path)

test_dir&#x3D;&#39;..&#x2F;test_case&#39;
report_dir&#x3D;&#39;..&#x2F;reports&#39;

discover&#x3D;unittest.defaultTestLoader.discover(test_dir,pattern&#x3D;&#39;test_login.py&#39;)

now&#x3D;time.strftime(&#39;%Y-%m-%d %H_%M_%S&#39;)
report_name&#x3D;report_dir+&#39;&#x2F;&#39;+now+&#39; test_report.html&#39;

with open(report_name,&#39;wb&#39;) as f:
    runner&#x3D;BSTestRunner(stream&#x3D;f,title&#x3D;&#39;Kyb Test Report&#39;,description&#x3D;&#39;kyb Android app test report&#39;)
    logging.info(&#39;start run test case...&#39;)
    runner.run(discover)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="6-实现邮件发送-把这个生成测试报告与邮件发送的代码封装成函数"><a href="#6-实现邮件发送-把这个生成测试报告与邮件发送的代码封装成函数" class="headerlink" title="6.实现邮件发送,把这个生成测试报告与邮件发送的代码封装成函数"></a><strong>6.实现邮件发送,把这个生成测试报告与邮件发送的代码封装成函数</strong></h4><pre class="line-numbers language-none"><code class="language-none">import unittest
import os
from selenium import webdriver
from BSTestRunner import BSTestRunner
from email.mime.text import MIMEText #定义邮件内容
from email.header import Header #定义邮件标题
import smtplib #发送邮件模块
import time

#截图的函数
def insert_img(driver,filename):
    #获取当前模块所在的路径
    func_path&#x3D;os.path.dirname(__file__)
    #获取其上一级的目录
    base_dir&#x3D;os.path.dirname(func_path)
    #把上一级目录转换为字符串
    base_dir&#x3D;str(base_dir)
    #使用替换的方法
    base_dir&#x3D;base_dir.replace(&#39;\\&#39;,&#39;&#x2F;&#39;)
    base&#x3D;base_dir.split(&#39;&#x2F;Website&#39;)[0]
    filepath &#x3D; base + &#39;&#x2F;Website&#x2F;test_report&#x2F;screenshot&#x2F;&#39; + filename
    driver.get_screenshot_as_file(filepath)

#完善搜素最新报表的函数
def latest_report(report_dir):  #传入整个报表的路径
    lists &#x3D; os.listdir(report_dir)
    # 按时间顺序对该目录文件夹下面的文件进行排序
  lists.sort(key&#x3D;lambdafn:os.path.getatime(report_dir + &#39;\\&#39; + fn))
    print((&quot;new report is :&quot; + lists[-1]))

    file &#x3D; os.path.join(report_dir, lists[-1])
    print(file)#最新报表 .&#x2F;2021-8-17  11-32-00 ...Html  路径
    return file  #返回路径——最新报表

#实现发邮件的函数
def send_mail(latest_report):
    # 读取传进来  最新报表的  内容
    f &#x3D; open(latest_report,&#39;rb&#39;)
    mail_content &#x3D; f.read()  # 存入 mail_content
    f.close()

smtpserver&#x3D;&#39;邮箱地址&#39;
user&#x3D;&#39;发送人邮箱&#39;
password&#x3D;&#39;HTTP授权码&#39;

sender&#x3D;&#39;发送人邮箱&#39;
receives&#x3D;&#39;接收人邮箱&#39;

subject &#x3D; &#39;Web Selenium 自动化测试报告&#39;
content &#x3D; &#39;&lt;html&gt;&lt;h1 style&#x3D;&quot;color:red&quot;&gt;邮件内容&lt;&#x2F;h1&gt;&lt;&#x2F;html&gt;&#39;

    msg &#x3D; MIMEText(content, &#39;html&#39;, &#39;utf-8&#39;)
    msg[&#39;Subject&#39;] &#x3D; Header(subject, &#39;utf-8&#39;)
msg[&#39;From&#39;]&#x3D;&#39;发送人邮箱&#39;
msg[&#39;To&#39;]&#x3D;&#39;接收人邮箱&#39;

smtp&#x3D;smtplib.SMTP_SSL(smtpserver, 465)
smtp.helo(smtpserver)
smtp.ehlo(smtpserver)
smtp.login(user,password)
print(&quot;Start send Email...&quot;)
smtp.sendmail(sender,receives,msg.as_string())
smtp.quit()
print(&quot;Start  Email end!&quot;)


if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    test_dir &#x3D; &#39;..&#x2F;test_case&#39;
    report_dir &#x3D; &#39;..&#x2F;reports&#39;

    discover &#x3D; unittest.defaultTestLoader.discover(test_dir, pattern&#x3D;&#39;test*.py&#39;)

    now &#x3D; time.strftime(&#39;%Y-%m-%d %H_%M_%S&#39;)
    report_name &#x3D; report_dir + &#39;&#x2F;&#39; + now + &#39; test_report.html&#39;

    with open(report_name, &#39;wb&#39;) as f:
        runner &#x3D; BSTestRunner(stream&#x3D;f, title&#x3D;&#39;Kyb Test Report&#39;, description&#x3D;&#39;kyb Android app test report&#39;)
        # logging.info(&#39;start run test case...&#39;)
        runner.run(discover)
    f.close()
    latest_report &#x3D; latest_report(report_dir)
    send_mail(latest_report)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


        
            <div id="toc-article">
                
  <div class="widget-wrap" id="toc-wrap">
    <h3 class="widget-title"><i class="fa fa-toc"></i> 文章目录</h3>
    <div class="widget">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Pageobject-unittest"><span class="toc-text">一、Pageobject+unittest</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9C%BA%E6%99%AF%E6%A1%88%E4%BE%8B"><span class="toc-text">1. 场景案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-text">1) 案例分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%87%8D%E6%9E%84%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF"><span class="toc-text">2) 重构优化思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Page-Object"><span class="toc-text">3) Page Object</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">2. 代码实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-unittest%E7%94%A8%E4%BE%8B%E5%B0%81%E8%A3%85"><span class="toc-text">3. unittest用例封装</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-text">二、自动化测试框架综合案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A1%86%E6%9E%B6%E5%8A%9F%E8%83%BD"><span class="toc-text">1. 框架功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%B5%8B%E8%AF%95%E6%A1%88%E4%BE%8B"><span class="toc-text">2. 测试案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"><span class="toc-text">测试环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E7%94%A8%E4%BE%8B"><span class="toc-text">覆盖用例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">3. 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-driver%E9%85%8D%E7%BD%AE%E5%B0%81%E8%A3%85"><span class="toc-text">1) driver配置封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9F%BA%E7%B1%BB%E5%B0%81%E8%A3%85"><span class="toc-text">2) 基类封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-common%E5%85%AC%E5%85%B1%E6%A8%A1%E5%9D%97%E5%B0%81%E8%A3%85"><span class="toc-text">3) common公共模块封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%9D%97%E5%B0%81%E8%A3%85"><span class="toc-text">4) 业务模块封装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E6%A8%A1%E5%9D%97"><span class="toc-text">1. 登录页面业务逻辑模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-data%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85"><span class="toc-text">2. data数据封装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%83%8C%E6%99%AF"><span class="toc-text">使用背景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-text">案例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#enumerate-%E7%AE%80%E4%BB%8B"><span class="toc-text">enumerate()简介</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#enumerate-%E4%BD%BF%E7%94%A8"><span class="toc-text">enumerate()使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85"><span class="toc-text">数据读取方法封装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#utf-8%E4%B8%8Eutf-8-sig%E4%B8%A4%E7%A7%8D%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">utf-8与utf-8-sig两种编码格式的区别:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-config%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">3. config文件配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E5%B0%81%E8%A3%85"><span class="toc-text">4. 测试用例封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%89%A7%E8%A1%8C%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B-amp-%E6%8A%A5%E5%91%8A%E7%94%9F%E6%88%90"><span class="toc-text">5. 执行测试用例&amp;报告生成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%AE%9E%E7%8E%B0%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81-%E6%8A%8A%E8%BF%99%E4%B8%AA%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E4%B8%8E%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81%E7%9A%84%E4%BB%A3%E7%A0%81%E5%B0%81%E8%A3%85%E6%88%90%E5%87%BD%E6%95%B0"><span class="toc-text">6.实现邮件发送,把这个生成测试报告与邮件发送的代码封装成函数</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
  </div>


            </div>
        
        
          <blockquote id="copyright">
              <p>原文链接: <a href="http://example.com/2021/09/09/Appium案例整合/">http://example.com/2021/09/09/Appium案例整合/</a></p>
              <p>版权声明: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>分享到:</span>
    </div>



        </div>
      
      
        
<nav id="article-nav">
  
  
    <a href="/2021/09/08/Jmeter%E7%9A%84%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">older</strong>
      <div class="article-nav-title">Jmeter的基础操作</div>
    </a>
  
</nav>

      
      
        







      
    </footer>
  </div>
</article>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> 最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/09/09/Appium%E6%A1%88%E4%BE%8B%E6%95%B4%E5%90%88/">Appium案例整合</a>
          </li>
        
          <li>
            <a href="/2021/09/08/Jmeter%E7%9A%84%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/">Jmeter的基础操作</a>
          </li>
        
          <li>
            <a href="/2021/09/07/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%E4%B9%8Bpostman%E5%B7%A5%E5%85%B7/">接口测试之postman工具</a>
          </li>
        
          <li>
            <a href="/2021/09/07/%E5%AE%89%E5%8D%93%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/">安卓操作系统介绍</a>
          </li>
        
          <li>
            <a href="/2021/09/07/Appium%E7%AE%80%E4%BB%8B/">Appium简介</a>
          </li>
        
          <li>
            <a href="/2021/09/07/monkey%E8%87%AA%E5%AE%9A%E4%B9%89%E8%84%9A%E6%9C%AC%E5%AE%9E%E8%B7%B5/">monkey自定义脚本实践</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> 归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年09月09日</a><span class="archive-list-count">17</span></li></ul>
    </div>
  </div>


  
    

  
    

  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/sitemap.xml">网站地图</a>
        <span> | </span><a href="/atom.xml">订阅本站</a>
        <span> | </span><a href="/about/">联系博主</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2021 John Doe.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        
            <span>Count by <a href="http://busuanzi.ibruce.info/" target="_blank">busuanzi.</a></span>
        
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
    
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/search.json.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>






  
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



  
<script src="/localshare/js/social-share.js"></script>

  
<script src="/localshare/js/qrcode.js"></script>




















  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>
  <script src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML" async type="text/javascript"></script>

  </div>
</body>
</html>